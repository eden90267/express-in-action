# chap08. 利用MongoDB持久化你的數據

>**本章涵蓋**
>
>使用Mongoose，它是一個官方提供的，用於使用Node控制資料庫的庫。  
>使用bcypt安全創建用戶帳戶  
>使用Passport為用戶提供身份認證

## 為什麼是MongoDB ?

Web應用程序儲存它們的資料到兩種類型之一的資料庫：關聯式和非關聯式。

典型的關聯式資料庫有點類似於電子表格。它們的資料是結構化的，每個項目通常是表中的一行。這有點像諸如Java這樣的強類型語言，即每個項目必須符合嚴格的要求(稱為schema)。很多關聯式資料庫可以被延伸SQL控制；你可能聽說過MySQL或SQL Server或PostgreSQL，關聯式資料庫和SQL資料庫這兩個術語通常可以互換。

非關聯式資料庫通常被我們稱作NoSQL資料庫。(NoSQL意味所有的東西都不是SQL，但它指的往往是某一類資料庫。)我喜歡設想NoSQL為不同的技術並握拳反對現狀。假設NoSQL是反對者胳膊上的紋身。無論如何，NoSQL資料庫不同於關聯式資料庫，因為通常不像表格結構。他們通常沒有SQL資料庫這麼嚴格。它們這種方式很像JavaScript；JavaScript通常很少會嚴格。總之，NoSQL資料庫比SQL資料庫更像JavaScript。

Mongo十分流行。是一個成熟的項目，出現自2007年。它十分可靠，它用高性能的C++編寫並被大量的用戶信賴。

雖然Mongo並不是JavaScript編寫的，但它原生的shell使用的是JavaScript。這意味著當你打開Mongo並在控制台運行它的時候，你透過JavaScript給它發送命令。使用一種你已經使用的語言來跟資料庫進行對話是十分棒的。

>**注意** 如果你在循有用的SQL工具，可在[http://docs.sequelizejs.com/](http://docs.sequelizejs.com/)看一下Sequelize。它給很多SQL資料庫提供了接口，同時它還擁有大量的特性。Mongoose跟Mongo關係就像Sequelize跟SQL的關係。

### Mongo是如何工作的

大多數應用程序有一個資料庫，例如Mongo。這些資料庫由server託管。一個Mongo server可以有很多的資料庫，但是通常每個應用程序只會有一個資料庫。(這些資料庫可以被複製到多個server，但你把它們當作一個資料庫對待)。

訪問資料庫，會需要一個客戶端來與Mongo server交互、查看並操作資料庫。大多數編程語言都有客戶端庫；這些庫被稱為**驅動**，它們使得你可以用你喜歡的編程語言與資料庫進行交互。

每個資料庫都會有一個或多個集合。我喜歡把**集合當作陣列**。一個blog應用程序可能會有一個blog帖子的集合，或者一個社區可能會有一個用戶檔案集合。它們類似於矩陣中的巨大列表，但是你可以比陣列更加容易的查詢它們(例如，查找集合中所有年齡大於18歲的用戶)。

每個集合都有一些文檔。雖然文檔在技術上並不以JSON的形式儲存，但是你可以認為他們採用的是這種方式

![](http://i.imgur.com/81cke3y.png)